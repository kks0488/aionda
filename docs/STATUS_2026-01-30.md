# aionda / naver-blog 상태 메모 (2026-01-30)

작성일: 2026-01-30 (KST 기준)

## 목표

- “기능 추가”보다 **기존 파이프라인의 일관성/신뢰성 강화**
  - GitHub Actions CI 실패로 인한 알림(메일) 폭탄 해소
  - 네이버 블로그에만 선발행되고 본진(aionda.blog)에 안 보이는 불일치 해소
  - “최신” 섹션이 구형 모델/에버그린 글로 고정되어 보이는 문제 완화
  - DC Inside 비중을 낮추고(상대적으로) 해외/공식/보안/엔터프라이즈 소스를 강화

## 관찰된 증상

- GitHub Actions: `CI / build`가 10~20초 내 빠르게 실패 → GitHub 알림 메일 반복 발생.
- 네이버 블로그에는 글이 2개 올라갔는데(서로 유사), 본진에선 안 보이거나/홈에 안 뜨는 느낌.
- “최신” 섹션이 트렌드와 동떨어진 글(구형 모델 비교 등)로 고정되어 보임.

## 핵심 원인(요약)

1) **CI 실패**
- `pnpm install --frozen-lockfile` 단계에서 `pnpm-lock.yaml` 불일치로 실패하던 상태.

2) **네이버 선발행/중복**
- `projects/naver-blog`가 **본진 사이트**를 읽는 게 아니라, 별도 클론(`projects/naver-blog/aionda`)의 **MDX 파일**을 읽어 네이버에 올리는 구조라서,
  - 본진 배포가 깨져도 네이버 발행은 진행될 수 있고,
  - 동시에 두 번 실행되면(스케줄/수동 등) 중복 발행 가능.

3) **“최신” 체감 문제**
- 홈 “Latest”가 “새 글 슬라이스” 성격이라, 에버그린/설명글이 최신 날짜로 들어오면 트렌드처럼 보일 수 있음.
- 프롬프트에서 특정 레거시 모델명/버전을 강하게 언급하면 앵커링이 생길 수 있음.

## 적용한 변경(강화 중심)

### A) aionda CI/배포 안정화

- `projects/aionda/pnpm-lock.yaml` 갱신(로컬에서 `pnpm install --frozen-lockfile` 통과 확인).

### B) naver-blog: 단일 SSOT + 배포 확인 후 발행(Deploy-first gate)

**목표**: “네이버에만 먼저 올라가고 본진엔 없다”를 구조적으로 차단.

- SSOT 통합
  - `projects/naver-blog/config.py`에서 기본 `AIONDA_REPO`를 `projects/aionda`로 사용하도록 변경.
  - 환경변수 `AIONDA_REPO_PATH`로 오버라이드 가능.
- 배포 확인 게이트(기본 ON)
  - `projects/naver-blog/aionda_sync.py`에 `is_post_deployed(slug)` 추가:
    - `AIONDA_SITE_URL/ko/posts/{slug}`가 HTTP 200인지 확인(HEAD 실패 시 GET fallback).
  - `projects/naver-blog/main.py`의 `post` 커맨드에서:
    - 배포 확인(HTTP 200)된 글만 네이버 발행
    - 배포 전이면 이번 런에서는 제외하고 다음 런에서 재시도
  - 강제 우회 옵션: `python main.py post --skip-deploy-check`
- 중복 발행 방지(동시 실행 락)
  - `projects/naver-blog/main.py`에 `aionda_post.lock`(fcntl flock) 추가.

### C) 소스 품질 강화(해외/공식/보안/엔터프라이즈)

- `projects/aionda/scripts/crawl-rss.ts`에 공식/보안/엔터프라이즈 RSS 소스 추가:
  - Microsoft Azure Blog, Cloudflare Blog, Google Threat Intelligence(Mandiant), CrowdStrike Blog 등.

### D) 자동 발행 튜닝(DC 비중 낮추기)

- `projects/aionda/scripts/auto-publish.sh` 기본값:
  - `AUTO_PUBLISH_TREND_EVERY`: `3 → 5`
  - `AUTO_PUBLISH_STANDARD_SINCE`: `24h → 72h`
- 문서 반영: `projects/aionda/docs/WORKFLOW.md`

### E) “최신이 구형 모델로 고정” 체감 완화

- 홈 정렬 개선: `projects/aionda/apps/web/components/HomeContent.tsx`
  - Latest에서 `k-ai-pulse` 태그를 우선 노출하고 에버그린 성격 글을 후순위로 배치하도록 조정.
- 프롬프트 앵커링 완화: `projects/aionda/scripts/prompts/topics.ts`
  - “레거시 모델”을 명시적으로 고정하는 지시 대신,
  - **원문에 명시된 경우에만 모델/버전 언급**하도록 변경.
- 추출 단계에서 저신호 레거시 중심 아이템 완화: `projects/aionda/scripts/extract-topics.ts`
  - 레거시 모델만 언급 + 고신호/현세대 언급 없음 → 낮은 우선순위/스킵 로직 추가.

## 빠른 검증 결과

- aionda:
  - `pnpm -s content:lint -- --all` 실행(경고/제안 다수, 에러 0)
  - `pnpm --filter web lint` 실행(경고만)
  - `pnpm -s build` 실행 성공
- naver-blog:
  - `python -m py_compile` 성공
  - `python main.py status` 정상 동작
  - `is_post_deployed()` 테스트: 실존 slug는 True / 가짜 slug는 False
- 프로덕션 체크:
  - `https://www.aionda.blog/ko/posts/google-project-genie-world-model-test` → 200 확인
  - `https://aionda.blog/...`는 307 리다이렉트가 관찰됨(실제 검증은 `www` 도메인을 기준으로 하는 편이 안전)

## 데이터 관측(DC vs 뉴스/공식 비중; 발행 기준)

- 최근 7일(2026-01-23~01-30) published 100개 기준:
  - raw(DC) 6 / news 79 / official 15
  - DC 비중 약 6%
- 최근 30일 published 439개 기준:
  - raw 110(25%) / news 164(37%) / official 165(38%)

## 남은 TODO (다음 재개 지점)

1) **커밋/푸시**
- 로컬에서 고친 CI/파이프라인/프롬프트 변경이 아직 미푸시 상태면, GitHub Actions 메일은 계속 올 수 있음.
- `projects/aionda`와 `projects/naver-blog` 각각 변경 사항을 커밋/푸시하는 단계가 필요.

2) 운영상 확인
- 본진 홈에서 “최신” 정렬 체감이 개선되었는지 실제 사용자 관점 검증.
- naver-blog가 배포 게이트로 스킵한 글이 다음 런에서 정상적으로 따라오는지 확인.

---

## 2026-01-31 추가 조치: “구형 모델 앵커링/커뮤니티발 글” 정교화

### 1) 레거시 모델 앵커링 방지 게이트

- `scripts/content-gate.ts`에 “최근 글(30일)에서 레거시 모델을 **본문에서만** 언급하면서,
  - ‘과거 사례’ 표기도 없고,
  - 현세대 컨텍스트도 없으면
  - publish gate에서 실패” 규칙 추가.

목적:
- 사실이 틀리지 않더라도 사이트가 “구형 세대에 고정”되어 보이는 체감을 차단.

### 2) 커뮤니티(Primary tier C) 기반 글의 증거(출처) 요구

- `scripts/content-gate.ts`에 “최근 글(30일)에서 primary source가 Tier C인 경우:
  - 본문/References에 Tier S/A 링크가 최소 1개 이상 있어야 함” 규칙 추가.

목적:
- 커뮤니티 글을 ‘영감’으로 쓰되, 본문은 반드시 신뢰 출처로 뒷받침.

### 3) content verification “무검증 통과” 방지 + fallback

- Gemini가 `extractClaims`에서 `AbortError` 등으로 실패할 때,
  - 기존: claims=0으로 사실상 무검증 통과 가능
  - 개선: `scripts/content-verify.ts`에서 **deterministic fallback claim extraction**을 수행해 검증을 계속 진행.

결과:
- `pnpm content:verify`가 API 일시 실패에도 “검증 시도 자체”가 유지됨.

## 재개용 커맨드 모음

- naver-blog 상태:
  - `cd projects/naver-blog && python main.py status`
- naver-blog 발행(배포 확인 ON):
  - `cd projects/naver-blog && python main.py post 1`
- 배포 확인 우회(긴급):
  - `cd projects/naver-blog && python main.py post --skip-deploy-check 1`
- aionda 로컬 빌드 체크:
  - `cd projects/aionda && pnpm -s build`
